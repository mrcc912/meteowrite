var mongoose  = require('mongoose');
var alchemy = require('alchamy');
var sha1 = require("sha1");
var zipcodes = require('zipcodes');

var ObjectId = mongoose.Types.ObjectId;

mongoose.connection.on('open', function (ref) {
    console.log('Connected to mongo server.');
});

mongoose.connection.on('error', function (err) {
    console.log('Could not connect to mongo server!');
    console.log(err);
});

mongoose.connect("mongodb://ec2-54-235-227-153.compute-1.amazonaws.com/raw");
//mongoose.connect("mongodb://ec2-50-19-21-233.compute-1.amazonaws.com/raw");
var db = mongoose.connection;
var Schema = mongoose.Schema;

/* Schema and Object Declarations */

var APIUserSchema = mongoose.Schema({
    api_key: String,
    name: String,
    use_count: Schema.Types.Mixed
});

var ArticleSchema = mongoose.Schema({
    id: Number,
    headline: String,
    biline: String,
    creditline: String,
    source: String,
    section: String,
    URL: String,
    body: String,
    keywords: Schema.Types.Mixed,
    keywordsCalais: Schema.Types.Mixed,
    keywordsCore: Schema.Types.Mixed,
    readers: [String]
});

var UserSchema = mongoose.Schema({
    username: String,
    fullname: String,
    hometown: String,
    current_location: String,
    gender: String,
    languages: [String],
    work: [String],
    articlesRead: [Number],
    tweetsRead: [String],
    facebookLikes: [String],
    keywords: Schema.Types.Mixed,
    interests: Schema.Types.Mixed,
});

var User = mongoose.model("User", UserSchema);
var Article = mongoose.model("Article", ArticleSchema);
var APIUser = mongoose.model("APIUser", APIUserSchema);

/* HELPER FUNCTIONS */
function insertKeywordIntoList(word, relev, list)
{
    var found = -1;
    for(i in list)
    {
	if(list[i].text == word)
	{
	    found = i;
	    break;
	}
    }
    if(found > 0)
    {
	list[found].rel += relev;
    }
    else
    {
	var keyObj = new Object();
	keyObj.text = word;
	keyObj.rel = relev;
	list.push(keyObj);
    }		
}

/* APIUSER FUNCTIONS */
exports.addAPIUser = function(name)
{
    APIUser.findOne({name: name}, function(err, api){
	if(err) throw err;
	if(api)
	{
	    //console.log('already exists');
	    //console.log(api);
	}
	else{
	    var arr = new Array();
	    var hash = sha1(name);
	    var api = new APIUser({
		name: name,
		api_key: hash,
		use_count: arr
	    });
	    api.save(function(err, art){
		if(err) throw err;
		if(art)
		{
		    //correctly saved =D
		    //console.log(art);
		}
	    });	    
	}
    });
}

exports.removeAPIUser = function(key)
{
    APIUser.findOne({api_key: key}, function(err, api){
	if(err) throw err;
	if(api)
	    api.remove();
    });
}

exports.reportAPIuse = reportAPIuse;

function reportAPIuse(key, func_name)
{
    console.log("Reporting API use: " + key + "::" + func_name);
    APIUser.findOne({api_key: key}, function(err, api){
	if(err) throw err;
	if(api)
	{
	    var now = new Date();
	    var use = {api: func_name, time: now};
	    api.use_count.push(use);
	    console.log(api.use_count); 
	    api.markModified('use_count');
	    api.save(function(err, res){
		if(err) throw err;
		if(res)
		{
		    console.log("saved apikey");
		    console.log(res);
		    //huzzah saved
		}
	    });
	}
    });
}

exports.getAPIUseForKey = function(key, func)
{
    APIUser.findOne({api_key: key}, function(err, api){
	if(err) throw err;
	if(api)
	{
	    func(api.use_count);
	}
    });
}

/* END OF APIUSER FUNCTIONS */

exports.addUser = function(name, fname, home, curr, gen, lang, work)
{
    User.findOne( {username: name}, function(err, user){
	if(user)
	{

	}
	else
	{
	    //create user
	    //var object = new Object();
	    //object["meteowrite-secret-num"] = 1.0;
	    var object = new Array();
	    var newUser = new User({
		username: name,
		fullname: fname,
		hometown: home,
		current_location: curr,
		gender: gen,
		languages: lang,
		work: work,
		keywords: object
	    });
	    newUser.save(function(err,doc){
		if(err) throw err;
		console.log(doc);
	    });
	}
    });
};

exports.removeUser = function(name)
{
    User.findOne({username: name}, function(err, user){
	if(err) throw err;
	if(user)
	    user.remove();
    });
};

exports.getUsers = function(func) {
  User.find(function(err,users) {
    if(err) throw err;
      if(users)
	  func(users);
  });
};

exports.getUser = function(userid, func)
{
    User.findOne( {username: userid}, function(err, user){
	if(err) throw err;
	func(user);
    });
};
/* END OF USER FUNCTIONS */

/* ARTICLE FUNCTIONS */
exports.getArticles = function(func) {
  Article.find(function(err,articles) {
    if(err) throw err;
      if(articles)
	  func(articles);
  });
};

exports.getArticle = function(articleid, func) {
  Article.findOne({id: articleid}, function(err, article){
    if(err) throw err;
      if(article)
	  func(article); 	
      else
	  func(-1);
  });
};

/* obsolete method */
exports.addKeywords = function(userID, articleID, keys)
{
    User.findOne( {username: userID}, function(err, user){
	if(err) throw err;
	if(user)
	{
	    for(var i=0; i<keys.length; i++)
	    {
		var key = keys[i].text;
		if(keys[i].text.indexOf('.') != -1)
		    continue;
		if(user.keywords[keys[i].text])
		{
		    user.keywords[keys[i].text] += keys[i].relevance;
		}
		else
		{
		    user.keywords[keys[i].text] = keys[i].relevance;
		}
	    }
	    console.log(user.keywords);
            user.articlesRead.push(articleID);          
            saveUser(user);
	}
    });
};

exports.addTweet = function(userID, tweetID, keys)
{
    User.findOne( {username: userID}, function(err, user){
	if(err) throw err;
	if(user)
	{
	    for(var i=0; i<keys.length; i++)
	    {
		var key = keys[i].text;
		var rel = keys[i].relevance;
		if(keys[i].text.indexOf('.') != -1)
		    continue;
		
		insertKeywordIntoList(key, rel, user.keywords);
	    }
	    
	    if(!user.tweersRead) 
		user.tweetsRead = new Array();
            user.tweetsRead.push(articleID);
            saveUser(user);
	}
    });
};

exports.articleOverlap = function(func) {
    var articles = Article.find(function(err,articles) {
    if(err) throw err;
    var smoke = new Object();
    for(var i = 0; i < articles.length; i++) {
      var articleId = articles[i].id;
      for(var j = 0; j < articles[i].keywords.length; j++) {
        var curMap = articles[i].keywords[j];
        var curText = curMap["text"];
        if(curText in smoke) {
          smoke[curText].push(articleId);
        }
        else {
          smoke[curText] = new Array();
          smoke[curText].push(articleId);
        }
      }
    }
    func(smoke);
  });
};

exports.addArticle = function(ID, head, bi, credit, src, sec, url, bod, func)
{
    Article.findOne( { id : ID}, function(err, article){
	if(article)
	{
	}
	else
	{
	    // read through article

	    // create article
	    var newArticle = new Article({
		id : ID,
		headline: head,
		biline: bi,
		creditline: credit,
		source: src,
		section: sec,
		URL: url,
		body: bod,
	    });
	    newArticle.save(function(err, doc){
		if(err) console.log(err);
		console.log(doc);
		//populate with keywords
		
		func(doc);
	    });
	    console.log(newArticle);
	    
	}
    });
};

exports.populateKeywords = function(ID, keywords)
{
    Article.findOne( {id: ID} , function(err, article){
	if(err) throw err;
	if(article)
	{
	    article.keywords = keywords;
	    article.save(function(err, doc){
		if(err) throw err;
		if(doc)
		{
		    //huzzah
		}
	    });
	}
    });
};

/* deprecated function */
function saveUser(user) {
    var newusername= user.username;
    var newfullname= user.fullname;
    var newhometown= user.hometown;
    var newcurrent_location= user.current_location;
    var newgender= user.gender;
    var newlanguages= user.languages;
    var newwork= user.work;
    var newarticles = user.articlesRead;
    var newkeywords= user.keywords;
    var newUser = new User({
	username: newusername,
	fullname: newfullname,
	hometown: newhometown,
	current_location: newcurrent_location,
	gender: newgender,
	languages: newlanguages,
	work: newwork,
	articlesRead: newarticles,
	keywords: newkeywords
    });
    
    user.remove();
    newUser.save(function(err, doc){
	if(err) throw err;
    });
}

exports.getUserFacebookLikes = function(username, token, func)
{
    var fql = require('fql');
    var https = require("https");

    var recs = [];
    fql({token: token}).query('SELECT uid FROM user WHERE username = "' + username+'"', function(err, data) {
	if (err) {
            throw err;
	}
	var id = data[0].uid;
	console.log(id);
	var mrcc = 505371215;
	

	var buffer = '';
	
	var path = "https://graph.facebook.com/" + id +"?fields=id,name,interests,likes&access_token=" + token; 
	https.get(path,
		  function(result){
		      
		      result.on('data', function(chunk){
			  buffer += chunk;
		      });
		      
		      result.on('end', function(){
			  console.log(buffer);
			  var obj = JSON.parse(buffer);
			  var likes = obj.likes.data;
			  var likeArr = [];
			  for(num in likes)
			  {
			      likeArr.push(likes[num].name);
			  }
			  User.findOne({}, function(err, user){
			      if(err) throw err;
			      if(user)
			      {
				  for(num in likeArr)
				  {
				      user.facebookLikes.push(likeArr[num]);
				  }
				  
			      }
			      user.save(function(err, doc){
				  if(err) throw err;
				  if(doc)
				  {
				      //huzzah
				  }
			      });
			      //saveUser(user);
			      func(likeArr);
			  });
		      });
		      
		  });
    });
    
}

exports.getArticlesRelatedToFacebook = function(username, token,  func)
{
    //get user likes from facebook
    var fql = require('fql');
    var https = require("https");
    
    var recs = [];
    fql({token: token}).query('SELECT uid FROM user WHERE username = "' + username+'"', function(err, data) {
	if (err) {
            throw err;
	}
	var id = data[0].uid;
	console.log(id);
	var mrcc = 505371215;
	

	var buffer = '';
	
	var path = "https://graph.facebook.com/" + id +"?fields=id,name,interests,likes&access_token=" + token; 
	https.get(path,
		  function(result){
		      console.log("huzzah");
		      
		      result.on('data', function(chunk){
			  buffer += chunk;
		      });
		      
		      result.on('end', function(){
			  console.log(buffer);
			  var obj = JSON.parse(buffer);
			  var likes = obj.likes.data;
			  var likeArr = [];
			  for(num in likes)
			  {
			      likeArr.push(likes[num].name);
			  }
			  Article.find({}).exec(function(err, articles){
			      if(err) throw err;
			      if(articles)
			      {
				  for(num in articles)
				  {
				      var words = articles[num].keywords;
				      for(num in words)
				      {
					  if( likeArr.indexOf(words[num].text) >= 0)
					  {
					      var newRec = {};
					      newRec.url = articles[num].URL;
					      newRec.keyword = words[num].text;
					      newRec.relevance = words[num].relevance;
					      
					      recs.push(newRec);   
					  }
				      }
				  }
			      }
			      func(recs);
			  });
			  
		      });
		      
		  });
    });
};

exports.addWordsToUserBlacklist = function(username, goodWords, func) {
  User.findOne({username: username}, function(err, user) {
    if(err) throw err;
    if(user) {
      var wordsToDelete = new Array();
      for(var key1 in user.keywords) {
        if(goodWords.indexOf(key1) == -1) {
          wordsToDelete.push(key1);
        }
      }
      for(var i = 0; i < wordsToDelete.length; i++) {
        delete user.keywords[wordsToDelete[i]];
      }
      saveUser(user);
      func(user); 
    } 
  });
};


exports.relatedArticlesForUserObj = function(user, numRec, func)
{
            var articleScores = new Object();
            var articleObject = new Object();
            Article.find(function(err,articles) {
              if(err) throw err;
              console.log(articles.length);
              for(var i = 0; i < articles.length; i++) {
                var art = articles[i];
                articleObject[art.headline] = new Object();
                if(user.articlesRead.indexOf(art.id) == -1) {
                  articleScores[art.headline] = 0;

                  for(var j = 0; j < art.keywords.length; j++) {
                    var keyMap = art.keywords[j];
                    var word = keyMap["text"];
                    var relev = keyMap["relevance"];
                    var userWord = 0;
                    if(word in user.keywords) {
                      console.log(word);
                      userWord = user.keywords[word];
                      articleObject[art.headline][word] = userWord*relev;
                    }
                      articleScores[art.headline] = articleScores[art.headline] + userWord * relev;
                  }

                  for(var j = 0; j < art.keywordsCalais.length; j++) {
                    var keyMap = art.keywordsCalais[j];
                    var word = keyMap["text"];
                    var relev = keyMap["relevance"];
                    var userWord = 0;
                    if(word in user.keywords) {
                      console.log(word);
                      userWord = user.keywords[word];
                      articleObject[art.headline][word] = userWord*relev;
                    }
                      articleScores[art.headline] = articleScores[art.headline] + userWord * relev;
                  }

		  for(var j = 0; j < art.keywordsCore.length; j++) {
                    var keyMap = art.keywordsCore[j];
                    var word = keyMap["text"];
                    var relev = keyMap["relevance"];
                    var userWord = 0;
                    if(word in user.keywords) {
                      console.log(word);
                      userWord = user.keywords[word];
                      articleObject[art.headline][word] = userWord*relev;
                    }
                      articleScores[art.headline] = articleScores[art.headline] + userWord * relev;
                  }
		  

                }
              }

              var artArr = new Array();
              for (var key in articleScores) {
                artArr.push([key, articleScores[key], articleObject[key]]);
              }

              for(var i = 0; i < artArr.length; i++) {
                for(var j = i; j < artArr.length; j++) {
                  if(artArr[i][1] < artArr[j][1]) {
                    var tmp = artArr[j];
                    artArr[j] = artArr[i];
                    artArr[i] = tmp;
                  }
                }
              }
              var retArr = new Object();
              var bla = numRec;
              if(bla > artArr.length) {
                bla = artArr.length;
              }
              for(var i = 0; i < bla; i++) {
                retArr[artArr[i][0]] = artArr[i][2];
              }

              func(retArr);
          });
};



exports.relatedArticlesForUser = function(username, numRec, func)
{
    User.findOne({username: username}, function(err, user){
	if(err) throw err;
	if(user)
	{
            var articleScores = new Object();
            var articleObject = new Object(); 
	    Article.find(function(err,articles) {
              if(err) throw err;
              console.log(articles.length);
              for(var i = 0; i < articles.length; i++) {
                var art = articles[i];
                articleObject[art.headline] = new Object();
                if(user.articlesRead.indexOf(art.id) == -1) {
                  articleScores[art.headline] = 0;
               
		  for(var j = 0; j < art.keywordsCalais.length; j++) {
                    var keyMap = art.keywordsCalais[j];
                    var word = keyMap["text"];
                    var relev = keyMap["relevance"];
                    var userWord = 0;
                    if(word in user.keywords) {
                      console.log(word);
                      userWord = user.keywords[word];
                      articleObject[art.headline][word] = userWord*relev;
                    }
                      articleScores[art.headline] = articleScores[art.headline] + userWord * relev;
                  }
 
                  for(var j = 0; j < art.keywordsCore.length; j++) {
                    var keyMap = art.keywordsCore[j];
                    var word = keyMap["text"];
                    var relev = keyMap["relevance"];
                    var userWord = 0;
                    if(word in user.keywords) {
                      console.log(word);
                      userWord = user.keywords[word];
                      articleObject[art.headline][word] = userWord*relev;
                    }
                      articleScores[art.headline] = articleScores[art.headline] + userWord * relev;
                  }
 
                  for(var j = 0; j < art.keywords.length; j++) {
                    var keyMap = art.keywords[j];
                    var word = keyMap["text"];
                    var relev = keyMap["relevance"];
                    var userWord = 0;
                    if(word in user.keywords) {
                      console.log(word);
                      userWord = user.keywords[word];
                      articleObject[art.headline][word] = userWord*relev;
                    }
                      articleScores[art.headline] = articleScores[art.headline] + userWord * relev;
                  }
                }
              }
            
              var artArr = new Array();
              for (var key in articleScores) {
                artArr.push([key, articleScores[key], articleObject[key]]);
              }

              for(var i = 0; i < artArr.length; i++) {
                for(var j = i; j < artArr.length; j++) {
                  if(artArr[i][1] < artArr[j][1]) {
                    var tmp = artArr[j];
                    artArr[j] = artArr[i];
   		    artArr[i] = tmp;
                  }
                }
              } 
              var retArr = new Object();
              var bla = numRec;
              if(bla > artArr.length) {
                bla = artArr.length;
              }
              for(var i = 0; i < bla; i++) {
                retArr[artArr[i][0]] = artArr[i][2];
              }

              func(retArr);
          });
        }
    });
};

/* PUBLIC API METHODS */

exports.getTopKeywordsForArticle = function(articleID, num, api_key, func)
{
    reportAPIuse(api_key, "getTopKeywordsForArticle");
    Article.findOne({id: articleID}, function(err, article){
	if(err)
	{
	    throw err;
	}
	if(article)
	{
	    var sorted = article.keywords.slice(0).sort(function(a, b){ 
		return b.relevance - a.relevance });
	    var result = [];
	    //if num is greater than 0, return num entries, else return all
	    if(num >0)
	    {
		for(var i=0; i<num; i++)
		    result.push({text: sorted[i].text, rel: sorted[i].relevance});
		func(result);
	    }
	    else
		func(sorted);
	}
	else
	{
	    func("could not find the article with that id");
	}
    });
}

exports.getArticleReaderInterests = function(articleID, api_key, func)
{
    reportAPIuse(api_key, "getArticleReaderInterests");
    Article.findOne({id: articleID}, function(err, article){
	if(err)
	    throw err;
	if(article)
	{
	    var interests = new Array();
	    User.find({username: {$in : article.readers}}, function(err2, readers){
		if(err2) throw err2;
		if(readers)
		{
		    for(var i=0; i<readers.length; i++)
		    {
			var reader = readers[i];
			for(var j=0; j<reader.keywords.length; j++)
			{
			    insertKeywordIntoList(reader.keywords[j].text, reader.keywords[j].rel, interests);		
                        }
		    }
		    var result = interests.sort(function(a,b){ return b.rel - a.rel;});
		    func(result);
		}
	    });
		     
		      /*
	    for(var i=0; i<article.readers.length; i++)
	    {
		User.findOne({username: article.readers[i]}, function(err, reader){
		    if(err) throw err;
		    if(reader)
		    {
			for(var j=0; j<reader.keywords.length; j++)
			{
			    insertKeywordIntoList(reader.keywords[j].text, reader.keywords[j].rel, interests);			
                        }
			var result = interests.sort(function(a,b){ return b.rel - a.rel;});
			func(result);
		    }
		});
	    }
*/
	}
	else
	{
	    func("Could not find an article with that ID");
	}
    });
}

exports.getAuthorKeywords = function(author, api_key, func)
{
    reportAPIuse(api_key, "getAuthorKeywords");    
    console.log("now I am here");
    var reg = new RegExp(author);
    var query = Article.find({biline: reg});
    console.log(author);
    if(author == "")
	query.limit(20);
    query.exec(function(err, articles){
	if(err) throw err;
	if(articles)
	{
	    var keywords = new Array();
	    for(index in articles)
	    {
		for(word in articles[index].keywords)
		{
		    insertKeywordIntoList(articles[index].keywords[word].text, articles[index].keywords[word].relevance, keywords);
		}
	    }
	    var sorted = keywords.sort(function(a, b){return b.rel - a.rel});
	    func(sorted);
	}
	else
	{
	    console.log("did not find any articles for that author");
	    func("Could not find any articles with that biline");
	}
    });
}

exports.getArticleFacebook = function(articleID, api_key, func)
{
    reportAPIuse(api_key, "getArticleFacebook");
    Article.findOne({_id : ObjectId(articleID)}, function(err, article){
	var allLikes = [];
	for(index in article.readers)
	{
	    var user = article.readers[index]
	    User.findOne({username: user}, function(err, user){
		if(err) throw err;
		if(user)
		{
		    for(i in user.facebookLikes)
		    {
			allLikes.push(user.facebookLikes[i]);
		    }
		}
	    });
	}
	func(allLikes);
    });
}


exports.userReadArticle = function(userID, articleID, api_key, func)
{
    reportAPIuse(api_key, "userReadArticle");
    var user = "" + userID;
    User.findOne({username: user}, function(err, user){
	if(err) throw err;
	if(user)
	{
	    var art_id = parseInt(articleID);
            var bool = 0;
            for(var i = 0; i < user.articlesRead.length; i = i + 1) {
		if(user.articlesRead[i] == art_id) {
                    bool = 1;
		}
            }
            if(bool == 0) {
		Article.findOne({id: art_id}, function(err, article){
		    if(err) throw err;
		    if(!article)
		    {
			func("articleID does not exist in database");
			return;
		    }
		    // if the article has not already been read by that user, mark it read
		    if(article.readers.indexOf(userID) < 0)
			article.readers.push(userID);

		    article.save(function(err, doc){
			if(err) throw err;
			if(doc)
			{
			    //huzzah! article saved correctly
			    //console.log(doc);
			}
		    });
		    for(i in article.keywords) 
		    {
			var textMap = article.keywords[i];
			var word = textMap["text"];
			//console.log(textMap);
			if(word.indexOf(".") != -1) 
			    continue;
			var relev = textMap["relevance"];
			insertKeywordIntoList(word, relev, user.keywords);
		    }

                    //for(var i = 0; i<article.keywordsCalais.length; i++)
		    for(i in article.keywordsCalais)
                    {
			var textMap = article.keywordsCalais[i];
			console.log(textMap);
			var word = textMap["text"];
			if(word.indexOf(".") != -1)
			    continue;
			var relev = textMap["relevance"];
			insertKeywordIntoList(word, relev, user.keywords);
                    }
		  
		    //console.log(article.keywordsCore);
                    /*
		    for(var i = 0; i<article.keywordsCore.length; i++)
                    {
			var textMap = article.keywordsCore[i];
			var word = textMap["text"];
			if(word.indexOf(".") != -1)
			    continue;
			var relev = textMap["relevance"];
			if(word in user.keywords) {
			    user.keywords[word] += relev;
			}
			else {
			    user.keywords[word] = relev;
			}
                    }
		    */
		    user.articlesRead.push(art_id);
		    user.markModified('keywords');
		    user.save(function(err, new_user){
			if(err) throw err;
			if(new_user)
			{
			}
		    });
                    func(user);
		});
            }
            else {
		func("Article already read by that user");
            }
	}
	else
	{
	    func("Could not find that username");
	}
    });
};

exports.getUsersWithParameters = function(params, api_key, func)
{
    /*
      console.log(params);
      console.log("api_key: " + api_key);
      func("");
    */
}

exports.reccomendAd = function(userID, ads, api_key, func)
{
    reportAPIuse(api_key, "reccomendAd");
    User.findOne({username: userID}, function(err, user){
	if(err) throw err;
	if(user)
	{
	    var use_location = false;
	    var user_loc = user.current_location.split(",");
	    var user_city = user_loc[0];
	    var user_state = user_loc[1].replace(/\s+/g, '');
	    var user_zip = zipcodes.lookupByName(user_city, user_state);
	    //compare location  and initalize score
	    if(user_zip.zip)
		use_location = true;
	    for(ad in ads)
	    {
		
		ads[ad].score = 0.0;
		
		if(use_location)
		{
		    //check zipcode
		    var loc = ads[ad].location.split(",");
		    var city = loc[0];
		    var state = loc[1].replace(/\s+/g, '');
		    var zip = zipcodes.lookupByName(city, state);
		    if(zip.zip)
		    {
			var dist = zipcodes.distance(zip[0], user_zip[0]);
			dist *= 0.1;
			ads[ad].score -= dist;
		    }
		}
	    }

	    //look for keywords
	    for(word in user.keywords)
	    {
		for(ad in ads)
		{
 		    if(ads[ad].keywords.indexOf(user.keywords[word].text) != -1)
		    {
			console.log("huzzah a match");
			//update score
			ads[ad].score += user.keywords[word].rel;
		    }
		    else if( user.keywords[word].text.indexOf(ads[ad].keywords) != -1)
		    {
			console.log("huzzah a match");
			//update score
			ads[ad].score += user.keywords[word].rel;
		    }
		}
	    }
	    
	    var result = ads.sort(function(a, b){return b.score - a.score;});
	    func(result);
	}
	else
	{
	    func("Could not find a user with username: " + userID);
	}
    });
}